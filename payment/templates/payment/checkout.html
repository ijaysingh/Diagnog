<!-- This page is to complete the checkout -->


{% block content %}
{% load static %}

<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Vicodin - Medical eCommerce HTML Template</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Place favicon.png in the root directory -->
    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon" />
    
	<style>
        .muted {
            color: #8e7f7f;
            display: block;
            margin-bottom: 10px;
            text-align: center;
        }
        .btn_container {
            padding: 20px;
            text-align: center;
        }
        .btn {
            border-radius: 4px;
            cursor: pointer;
            padding: 4px 8px;
            background-color: #ffaaa7;
            color: white;
            font-size: 1.2em;
            font-weight: 600;
            letter-spacing: 1px;
        }
        .btn-sm{
            padding:.25rem .5rem;
            font-size:.875rem;
            border-radius:.2rem
        }
        #snackbar {
            visibility: hidden;
            min-width: 150px;
            margin-left: -125px;
            background-color: #00331a;
            color: #fff;
            text-align: center;
            border-radius: .2rem;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 40px;
            font-size: .875rem;
          }
          
          #snackbar.show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
          }
          
          @-webkit-keyframes fadein {
            from {bottom: 0; opacity: 0;} 
            to {bottom: 40px; opacity: 1;}
          }
          
          @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 40px; opacity: 1;}
          }
          
          @-webkit-keyframes fadeout {
            from {bottom: 40px; opacity: 1;} 
            to {bottom: 0; opacity: 0;}
          }
          
          @keyframes fadeout {
            from {bottom: 40px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
          }
        </style>


    <!-- css files -->
    {% include 'include/css.html' %}

    <!-- js files -->
    {% include 'include/js.html' %}

</head>

<body>
    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

    <!-- Add your site or application content here -->

<!-- Body main wrapper start -->
<div class="body-wrapper">

    <!-- HEADER AREA START (header-3) -->
    {% include 'header/header.html' %}
    <!-- HEADER AREA END -->

    <!-- MOBILE MENU START -->
   
    <!-- MOBILE MENU END -->

    <!-- Utilize Cart Menu Start -->
   {% include 'widget/cart_menu.html' %}
    <!-- Utilize Cart Menu End -->

    <!-- Utilize Mobile Menu Start -->
    {% include 'header/mobile_menu.html' %}
    <!-- Utilize Mobile Menu End -->

    <div class="ltn__utilize-overlay"></div>

    <!-- BREADCRUMB AREA START -->
    <div class="ltn__breadcrumb-area text-left bg-overlay-white-30 bg-image "  data-bs-bg="{% static 'img/bg/14.jpg' %}">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ltn__breadcrumb-inner">
                        <h1 class="page-title">Checkout</h1>
                        <div class="ltn__breadcrumb-list">
                            <ul>
                                <li><a href="/"><span class="ltn__secondary-color"><i class="fas fa-home"></i></span> Home</a></li>
                                <li>Checkout</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- BREADCRUMB AREA END -->

    <!-- WISHLIST AREA START -->
    <div class="ltn__checkout-area mb-105">
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    <div class="ltn__checkout-inner">
                        {% if not user.is_authenticated %}
                        <div class="ltn__checkout-single-content ltn__returning-customer-wrap">
                            <h5>Returning customer? <a class="ltn__secondary-color" href="#ltn__returning-customer-login" data-bs-toggle="collapse">Click here to login</a></h5>
                            <div id="ltn__returning-customer-login" class="collapse ltn__checkout-single-content-info">
                                <div class="ltn_coupon-code-form ltn__form-box">
                                    <p>Please login your accont.</p>
                                    <form action="#" >
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="input-item input-item-name ltn__custom-icon">
                                                    <input type="text" name="ltn__name" placeholder="Enter your name">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="input-item input-item-email ltn__custom-icon">
                                                    <input type="email" name="ltn__email" placeholder="Enter email address">
                                                </div>
                                            </div>
                                        </div>
                                        <button class="btn theme-btn-1 btn-effect-1 text-uppercase">Login</button>
                                        <label class="input-info-save mb-0"><input type="checkbox" name="agree"> Remember me</label>
                                        <p class="mt-30"><a href="{% url 'password_reset' %}">Lost your password?</a></p>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        <div class="ltn__checkout-single-content ltn__coupon-code-wrap">
                            {% include 'widget/message.html' %}
                            <h5>Have a coupon? <a class="ltn__secondary-color" href="#ltn__coupon-code" data-bs-toggle="collapse">Click here to enter your code</a></h5>
                            <div id="ltn__coupon-code" class="collapse ltn__checkout-single-content-info">
                                <div class="ltn__coupon-code-form">
                                    <p>If you have a coupon code, please apply it below.</p>
                                    <form action="" >
                                        <input type="text" name="coupon-code" placeholder="Coupon code">
                                        <button class="btn theme-btn-2 btn-effect-2 text-uppercase applybtn">Apply Coupon</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% if user.is_authenticated %}
                        <div class="ltn__checkout-single-content-info" id="post-refresh-address">
                        <div class="ltn__checkout-single-content ltn__coupon-code-wrap">
                            <h5><a class="ltn__secondary-color hide-address" href="#ltn__address-form" data-bs-toggle="collapse">+ Click to add new address</a></h5>
                            <div id="ltn__address-form" class="collapse ltn__checkout-single-content-info">
                                <div class="ltn__address-form">
                                    <h4 class="title-2">Billing Details</h4>
                                    <div class="ltn__checkout-single-content-info">
                                        <div class="row">
                                        <form action="" method="POST" id="addressform">
                                        {% csrf_token %}
                                        <h6>Personal Information</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="input-item input-item-name ltn__custom-icon">
                                                    <input type="text" name="name" placeholder="First name">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="input-item input-item-name ltn__custom-icon">
                                                    <input type="text" name="lastname" placeholder="Last name">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="input-item input-item-email ltn__custom-icon">
                                                    <input type="email" name="email" placeholder="email address">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="input-item input-item-phone ltn__custom-icon">
                                                    <input type="text" name="phone" placeholder="phone number">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12 col-md-12">
                                                <h6>Address</h6>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="input-item">
                                                            <input type="text" name="street" placeholder="House number and street name">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="input-item">
                                                            <input type="text" name="apartment" placeholder="Apartment, suite, unit etc. (optional)">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-4 col-md-6">
                                                <h6>Town / City</h6>
                                                <div class="input-item">
                                                    <input type="text" name="city" placeholder="City">
                                                </div>
                                            </div>
                                            <div class="col-lg-4 col-md-6">
                                                <h6>State </h6>
                                                <div class="input-item">
                                                    <input type="text" name="state" placeholder="State">
                                                </div>
                                            </div>
                                            <div class="col-lg-4 col-md-6">
                                                <h6>Zip</h6>
                                                <div class="input-item">
                                                    <input type="text" name="zip" placeholder="Zip">
                                                </div>
                                            </div>
                                        </div>
                                        {% comment %} <p><label class="input-info-save mb-0"><input type="checkbox" name="agree"> Create an account?</label></p>
                                        <h6>Order Notes (optional)</h6>
                                        <div class="input-item input-item-textarea ltn__custom-icon">
                                            <textarea name="ltn__message" placeholder="Notes about your order, e.g. special notes for delivery."></textarea>
                                        </div> {% endcomment %}
                                        <button type="submit" class="submit-button-1" id="form-button"> Submit </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ltn__checkout-payment-method mt-50" id="addressId">
                    <h4 class="title-2">Address to: </h4>
                    <div id="address_accordion_1">
                        {% for address in addresses %}
                <!-- card -->
                <div class="card">
                    <h5 class="ltn__card-title" data-bs-toggle="collapse" data-bs-target="#faq-address-2-{{ address.id }}" aria-expanded="{% if order.address == address %}true{% else %}false{% endif %}">
                        {{ address.first_name }} {{ address.last_name }}
                    </h5>
                    <div id="faq-address-2-{{ address.id }}" class="{% if order.address == address %}show{% endif %} collapse" data-bs-parent="#address_accordion_1">
                        <div class="card-body">
                            <address>
                                <a href='mailto:{{ address.email }}'></a>{{ address.email }}<br>
                                {{ address.zip }},{{ address.street_address }} {{ address.city }}<br>
                                {{ address.state }}<br>
                                {{ address.phone }}
                            </address> 
                            <button type="submit" class="theme-btn-2 btn-effect-2 btn-sm addrjsBtn" data-id="{{ address.id }}"> Choose </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
                {% else %}
                        <div class="ltn__checkout-single-content mt-50">
                            <h4 class="title-2">Billing Details</h4>
                            <div class="ltn__checkout-single-content-info">
                                <div class="row">
                                <form action="" method="POST" id="addressform">
                                    {% csrf_token %}
                                    <h6>Personal Information</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="input-item input-item-name ltn__custom-icon">
                                                <input type="text" name="name" placeholder="First name">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-item input-item-name ltn__custom-icon">
                                                <input type="text" name="lastname" placeholder="Last name">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-item input-item-email ltn__custom-icon">
                                                <input type="email" name="email" placeholder="email address">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-item input-item-phone ltn__custom-icon">
                                                <input type="text" name="phone" placeholder="phone number">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-item input-item-website ltn__custom-icon">
                                                <input type="text" name="ltn__company" placeholder="Company name (optional)">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-item input-item-website ltn__custom-icon">
                                                <input type="text" name="ltn__phone" placeholder="Company address (optional)">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12">
                                            <h6>Address</h6>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="input-item">
                                                        <input type="text" name="street" placeholder="House number and street name">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="input-item">
                                                        <input type="text" name="apartment" placeholder="Apartment, suite, unit etc. (optional)">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6">
                                            <h6>Town / City</h6>
                                            <div class="input-item">
                                                <input type="text" name="city" placeholder="City">
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6">
                                            <h6>State </h6>
                                            <div class="input-item">
                                                <input type="text" name="state" placeholder="State">
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6">
                                            <h6>Zip</h6>
                                            <div class="input-item">
                                                <input type="text" name="zip" placeholder="Zip">
                                            </div>
                                        </div>
                                    </div>
                                    <p><label class="input-info-save mb-0"><input type="checkbox" name="agree"> Create an account?</label></p>
                                    <h6>Order Notes (optional)</h6>
                                    {% comment %} <div class="input-item input-item-textarea ltn__custom-icon">
                                        <textarea name="ltn__message" placeholder="Notes about your order, e.g. special notes for delivery."></textarea>
                                    </div> {% endcomment %}
                                    <button type="submit" class="submit-button-1" id="form-button"> Submit </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                <div class="col-lg-12">
                    <div class="ltn__checkout-payment-method mt-50">
                        <h4 class="title-2">Payment Method</h4>
                        <div id="checkout_accordion_1">
                            <!-- card -->
                            <div class="card">
									<h5 class="ltn__card-title" data-bs-toggle="collapse" data-bs-target="#faq-item-2-3" aria-expanded="true" >
										Pay Now <img src="{% static 'img/icons/payment-3.png' %}" alt="#">
									</h5>
									<div id="faq-item-2-3" class="collapse show" data-bs-parent="#checkout_accordion_1">
										<div class="card-body">
											<p>Pay now, and take part in cashless payments.</p>
										</div>
									</div>
							</div>              
                            <!-- card -->
                            <div class="card">
                                <h5 class="collapsed ltn__card-title" data-bs-toggle="collapse" data-bs-target="#faq-item-2-2" aria-expanded="false"> 
                                    Cash on delivery 
                                </h5>
                                <div id="faq-item-2-2" class="collapse" data-bs-parent="#checkout_accordion_1">
                                    <div class="card-body">
                                        <p>Pay with cash upon delivery.</p>
                                    </div>
                                </div>
                            </div>   
                        </div>
                        <div class="ltn__payment-note mt-30 mb-30">
                            <p>Your personal data will be used to process your order, support your experience throughout this website, and for other purposes described in our privacy policy.</p>
                        </div>
                    </div>
                </div>
            </div>
                <div class="col-lg-6">
                    <div class="shoping-cart-total mt-50">
                        <h4 class="title-2">Cart Totals</h4>
                        <table class="table" id="cart-total-table">
                            <tbody>
                                {% for item in items %}
                                <tr>
                                    <td>{{ item.product.productName }} <strong>× {{ item.quantity }}</strong></td>
                                    <td>₹{{ item.get_final_price }}</td>
                                </tr>
                                {% endfor %}
                                <tr>
                                    <td>Shipping and Handing</td>
                                    <td>$00.00</td>
                                </tr>
                                <tr>
                                    <td>Vat</td>
                                    <td>$00.00</td>
                                </tr>
                                <tr>
                                    <td><strong>Order Total</strong></td>
                                    <td><strong>₹{{ order.get_cart_total }}</strong></td>
                                </tr>
                                {% if order.coupon %}
                                <tr>
                                    <td>Coupon Discount</td>
                                    <td>₹{{ order.coupon.amount }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Final Order Total</strong></td>
                                    <td><strong>₹{{ order.get_cart_total_after_coupon }}</strong></td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="btn_container">
                    <!-- Payment Button -->
                    <button class="btn theme-btn-1 text-uppercases" id="pay-btn">Place Order</button>
                </div>
                </div>
            </div>
        </div>
    </div>
    <!-- WISHLIST AREA START -->
    <div id="snackbar">Address Updated..</div>

    <div class="card">
        <h1 class="title">Buy Me a Chai </h1>
        <small class="muted"
            >If you like my work, you can support me by donating ₹200</small
        >
        <div class="btn_container">
            <!-- Payment Button -->
            <button class="btn" id="pay-btn">Donate</button>
        </div>
    </div>

    <!-- CALL TO ACTION START (call-to-action-6) -->
    {% include 'widget/call_to_action.html' %}
    <!-- CALL TO ACTION END -->

    <!-- FOOTER AREA START -->
    {% include 'footer/footer.html' %}
    <!-- FOOTER AREA END -->
</div>
  
</body>
<!-- Razorpay's Javascript code. -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="{% static 'js/header.js' %}">
</script>
<script>
	var options = {
	
	// Enter the Key ID generated from the Dashboard
	key: "{{ razorpay_merchant_key }}",
	
	// Amount is in currency subunits.
	// Default currency is INR. Hence,
	// 50000 refers to 50000 paise
	amount: "{{ razorpay_amount }}",
	currency: "{{ currency }}",
	
	// Your/store name.
	name: "Dj Razorpay",
	
	// Pass the `id` obtained in the response of Step 1
	order_id: "{{ razorpay_order_id }}",
	callback_url: "{{ callback_url }}",
	};
	
	// initialise razorpay with the options.
	var rzp1 = new Razorpay(options);
	
	// add event listener to the payment button.
	document.getElementById("pay-btn").onclick = function (e) {
	rzp1.open();
	e.preventDefault();
	};


    var total = {{ order.get_cart_total }}
    $("#form-button").click(function(e) {
        e.preventDefault();
        var form = $("#addressform");
        console.log('submitted...')
        var x = document.getElementById("snackbar");
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 2000);
        $.ajax({
            url:'',
            type: 'POST',
            data: form.serialize(),
            success:function(data){
                console.log('data')
                var old_data = document.getElementById('post-refresh-address'); // old table 
                var htmlObject = $(data); 
                var new_data = htmlObject.find("#post-refresh-address").html(); // new table
                old_data.innerHTML=new_data;
            },
            error:function(){
                console.log('error')
            },
        });
    })

    var buttons = document.getElementsByClassName('addrjsBtn');
    for(var i=0; i<buttons.length; i++){
        buttons[i].addEventListener("click", function(){
            var addrId = $(this).data('id');
            console.log(addrId)
            var x = document.getElementById("snackbar");
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 2000);
            $.ajax({
                url:'',
                type: 'GET',
                data: {
                    'addrId':addrId
                },
                success:function(data){
                    console.log('data')
                },
                error:function(){
                    console.log('error')
                },
            });
            })
    }

    $("#selectAddr").click(function(e) {
        e.preventDefault();
        var addrId = $(this).data('id');
        console.log(addrId)
        $.ajax({
            url:'',
            type: 'GET',
            data: {
                'addrId':addrId
            },
            success:function(data){
                console.log('data')
            },
            error:function(){
                console.log('error')
            },
        });
    })
    function submitFormData(){
        console.log("form submit")
        var userformData = {
            'name': null,
            'email': null,
            'phone': null,
            'total': total,
        }
        var shippingInfo = {
            'street': null,
            'apartment': null,
            'city': null,
            'state': null,
            'zip': null,
        }
    }
    $(document).on('click','.hide-address',function(){
        var id = $(this).data('id');
        console.log('clicked..')
        var element = document.getElementById("addressId");
        var hidden = element.getAttribute("hidden");

        if (hidden) {
            element.removeAttribute("hidden");
        } else {
            element.setAttribute("hidden", "hidden");
        }
    });

</script>

</html>





{% endblock %}

